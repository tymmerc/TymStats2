<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Spotify Stats</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <h1>Spotify Statistics</h1>
    <canvas id="spotifyChart" width="400" height="200"></canvas>

    <script>
        // Récupérer l'access token depuis le stockage local
        const token = localStorage.getItem('spotifyAccessToken');

        if (token) {
            fetchSpotifyData(token);
        } else {
            console.log("Aucun token trouvé. Veuillez vous connecter à Spotify.");
        }

        function fetchSpotifyData(token) {
            fetch('https://api.spotify.com/v1/me/top/tracks?limit=10', {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            })
            .then(response => response.json())
            .then(data => {
                console.log("Données Spotify reçues :", data);
                if (data.items) {
                    createChart(data.items);
                } else {
                    console.log("Erreur : Impossible de récupérer les morceaux.");
                }
            })
            .catch(error => console.log("Erreur lors de la récupération des données Spotify :", error));
        }

        function createChart(tracks) {
            const ctx = document.getElementById('spotifyChart').getContext('2d');

            // Extraire les noms des chansons et leur popularité
            const labels = tracks.map(track => track.name);  // Noms des chansons
            const popularity = tracks.map(track => track.popularity);  // Score de popularité (0-100)

            // Données du graphique
            const chartData = {
                labels: labels,
                datasets: [{
                    label: 'Popularité des chansons',
                    data: popularity,
                    backgroundColor: 'rgba(0, 209, 178, 0.6)',
                    borderColor: 'rgba(0, 209, 178, 1)',
                    borderWidth: 1
                }]
            };

            // Configuration du graphique
            const config = {
                type: 'bar',
                data: chartData,
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(tooltipItem) {
                                    return tooltipItem.raw + ' points de popularité';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            };

            new Chart(ctx, config);
        }
    </script>
</body>
</html>
